name: Dependency Diagnostic

on:
  push:
    branches: [ main ]

jobs:
  debug-dependencies:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Show environment info
      run: |
        echo "Node version:"
        node --version
        echo "NPM version:"
        npm --version
        echo "Package.json contents:"
        type package.json

    - name: Install dependencies with verbose logging
      run: npm install --verbose

    - name: List installed packages
      run: |
        echo "node_modules structure:"
        dir node_modules
        echo "Checking for express:"
        dir node_modules\express || echo "Express not found"
        echo "Checking for cors:"
        dir node_modules\cors || echo "CORS not found"

    - name: Test simple require
      run: |
        echo "Testing require statements..."
        node -e "console.log('Express:', require('express')); console.log('CORS:', require('cors')); console.log('SUCCESS: All dependencies loaded');"
